<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap">
  <title>Visualization</title>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-sm navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="#">
      <img src="https://www.hawaii.edu/sustainability/wp-content/uploads/2019/03/UH-Office-of-Sustainability-400px.png"
           alt="Sustainability Office Logo">
    </a>
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="/show_entire_csv_data">Database</a></li>
      <li class="nav-item"><a class="nav-link" href="/visualization">Visualization</a></li>
    </ul>
    <div class="social-icons ms-auto">
      <a href="https://www.youtube.com/@OfficeOfSustainability-wt7px" class="nav-link"><i
          class="bi bi-youtube"></i></a>
    </div>
  </div>
</nav>

<!-- Visualization section -->
<div class="container my-5">
  <h2 class="table-header-name">Select a Building and Meter for Visualization</h2>

  <!-- Dropdown for building names -->
  <form id="buildingForm" action="" method="POST">
    <div class="mb-3">
      <label for="building_name">Select Building</label>
      <select class="form-select" id="building_name" name="building_name" required>
        <option value="" disabled selected>Select a building</option>
        {% for building in Buildings %}
          <option value="{{ building }}">{{ building }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  <!-- Dropdown for meter names (hidden initially) -->
  <form id="meterForm" action="" method="POST" style="display: none;">
    <div class="mb-3">
      <label for="meter_name">Select Meter</label>
      <select class="form-select" id="meter_name" name="meter_name" required>
        <option value="" disabled selected>Select a meter</option>
      </select>
    </div>
  </form>

  <!-- Container for Grafana graph -->
  <div class="canvas-container mt-4">
    <iframe id="meterGraph" src="" width="100%" height="400px"></iframe>
  </div>
</div>

<!-- Footer -->
<footer>
  <div class="container text-left py-2">
    <div class="row justify-content-between">
      <div class="col">
        <h2>Sustainability at UH Manoa</h2>
        <p>&copy; 2024 All rights reserved.</p>
      </div>
      <div class="col offset-1">
        <h2>Quick Links</h2>
        <ul class="list-unstyled">
          <li><a href="/">Home</a></li>
          <li><a href="/show_entire_csv_data">Database</a></li>
          <li><a href="/visualization">Visualization</a></li>
        </ul>
      </div>
      <div class="col">
        <h2>Contact Us</h2>
        <p>Email: sust@hawaii.edu</p>
      </div>
      <div class="col">
        <h2>Watch Us on YouTube</h2>
        <div class="social-icons">
          <a href="https://www.youtube.com/@OfficeOfSustainability-wt7px" class="nav-link"><i
              class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const meterGraph = document.getElementById('meterGraph');
  const meterNameSelect = document.getElementById('meter_name');
  const buildingNameSelect = document.getElementById('building_name');
  const meterForm = document.getElementById('meterForm');

  // Map meter names to buildings
  const metersByBuilding = {
    'Administration Services Building 1': ['admin_serv_1'],
    'Administration Services Building 2': ['admin_serv_2'],
    'Agricultural Engineering Institute': ['ag_engineering_main', 'ag_engineering_mcc'],
    'Agricultural Science': ['ag_science_main_1', 'ag_science_main_2', 'ag_science_mcc'],
    'Andrews Outdoor Theatre': ['andrews_amp_main'],
    'Architecture School': ['archtecture_main'],
    'Bachman Hall': ['bachman_hall_main']
  };

  // Event listener for building selection
  buildingNameSelect.addEventListener('change', function () {
    const selectedBuilding = this.value;
    const metersForBuilding = metersByBuilding[selectedBuilding] || [];

    // Clear previous meter options
    meterNameSelect.innerHTML = '<option value="" disabled selected>Select a meter</option>';

    // Populate meter dropdown with relevant meters
    metersForBuilding.forEach(function (meter) {
      const option = document.createElement('option');
      option.value = meter;
      option.textContent = meter;
      meterNameSelect.appendChild(option);
    });

    // Show the meter dropdown once a building is selected
    meterForm.style.display = metersForBuilding.length > 0 ? 'block' : 'none';
  });

  // Map meter names to Grafana URLs
  const grafanaUrls = {
    'Administration Services Building 1': 'http://localhost:8081/public-dashboards/1be0fab2accf4ba88302f1677c6b9747',
    'Administration Services Building 2': '',
    'Agricultural Engineering Institute': '',
    'Agricultural Science': '',
    'Andrews Outdoor Theatre': '',
    'Architecture School': '',
    'Bachman Hall': '',
    'Biomedical Sciences': '',
    'Building 37': '',
    'Building 1171': '',
    'Burns Hall': '',
    'Shidler College of Business': '',
    'Campus Center': '',
    'Cancer Center': '',
    'Clarence T. C. Ching Athletics Complex': '',
    'Cloning Laboratory': '',
    'C-MORE Hale (Center for Microbial Oceanography: Research and Education)': '',
    'Crawford Hall': '',
    'Dance Building': '',
    'Dean Hall': '',
    'Kahanamoku Pool': '',
    'Edmondson Hall': '',
    'Environmental Protection Facility': '',
    'Everly Hall': '',
    'Frear Hall': '',
    'Gartley Hall': '',
    'Gateway House': '',
    'George Hall': '',
    'Gilmore Hall': '',
    'Hale Aloha Ilima': '',
    'Hale Aloha Lehua': '',
    'Hale Aloha Lokelani': '',
    'Hale Aloha Mokihana': '',
    'Hale Halawai': '',
    'Hale Kahawai': '',
    'Hale Kuahine': '',
    'Hale Laulima': '',
    'Hale Manoa': '',
    'Hale Noelani': '',
    'Hale Wainani': '',
    'Hamilton Library': '',
    'Hawaii Hall': '',
    'Hemenway Hall': '',
    'Hawaii Institute of Geophysics': '',
    'Health and Physical Education and Recreation Klum Gym': '',
    'Health and Physical Education and Recreation Main': '',
    'Holmes Hall': '',
    'Jefferson Hall': '',
    'Johnson Hall': '',
    'Keller Hall': '',
    'Kennedy Theatre': '',
    'Center for Korean Studies': '',
    'Krauss Hall': '',
    'Kuykendall Hall': '',
    'Law Library': '',
    'Law School': '',
    'Les Murakami Stadium': '',
    'Life Sciences': '',
    'Lincoln Hall': '',
    'Maintenance Shop': '',
    'Malama Environmental Health & Safety': '',
    'Malama Dive Safety': '',
    'Marine Sciences Building': '',
    'Miller Hall': '',
    'Moore Hall': '',
    'Multipurpose Building': '',
    'Music Building Complex': '',
    'Pamoa Building': '',
    'Paradise Palms': '',
    'Parking Structure Phase 1': '',
    'Parking Structure Phase 2': '',
    'Pacific Biosciences Research Center Main A': '',
    'Pacific Biosciences Research Center Main B': '',
    'Physical Plant Building': '',
    'Physical Science Building': '',
    'Pope Laboratory': '',
    'Pacific Ocean Science and Technology': '',
    'Queen Liliuokalani Center for Student Services': '',
    'Quad Chiller Plant': '',
    'Sakamaki Hall': '',
    'Saunders Hall': '',
    'Sherman Laboratory': '',
    'Sinclair': '',
    'Softball Tennis': '',
    'Spalding Hall': '',
    'St. John Plant Science Lab': '',
    'Stan Sheriff Center': '',
    'Health Services': '',
    'Transportation Services': '',
    'University High School': '',
    'Warrior Recreation Center': '',
    'Webster Hall': '',
    'Wist Annex 1': '',
    'Wist Hall': ''
  };

  // Event listener for meter selection
  meterNameSelect.addEventListener('change', function () {
    const selectedMeter = meterNameSelect.value;
    if (grafanaUrls[selectedMeter]) {
      meterGraph.src = grafanaUrls[selectedMeter];
    } else {
      meterGraph.src = '';  // clear iframe if no URL is mapped
    }
  });

</script>

</body>
</html>
